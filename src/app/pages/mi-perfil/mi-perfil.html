<h2 class="text-3xl font-bold px-3">Mi Perfil</h2>

<article class="flex flex-col md:flex-row w-full min-h-screen gap-10">
  <div class="flex-1 flex flex-col mt-10">
    <div class="card">
      <div class="card-body">
        <h3 class="card-title mb-2"></h3>
        <div class="shrink-0 flex justify-center">
          <div
            class="w-40 h-40 rounded-full bg-[#d1d5db] flex items-center justify-center text-white font-semibold uppercase text-6xl"
          >
            {{ miembroActual.nombre.charAt(0) }}
          </div>
        </div>

        <form [formGroup]="perfilForm" class="mt-5">
          @if(modoContrasenia()){

          <div class="input-group py-2">
            <label class="input-helper"> Ingresa tu contraseña actual</label>
            <input
              type="password"
              class="bg-stone-100 border border-stone-300 rounded-[8px] px-3 py-2 text-gray-700"
              formControlName="actual"
            />
            @if (perfilForm.get('actual')?.invalid && perfilForm.get('actual')?.touched) {
            <p class="input-error-text">Este campo es obligatorio.</p>
            } @if (errorPassword()) {
            <div class="input-error-text">
              {{ errorPassword() }}
            </div>
            }
          </div>

          <div class="input-group py-2">
            <label class="input-helper"> Ingresa la nueva contraseña</label>
            <input
              type="password"
              class="bg-stone-100 border border-stone-300 rounded-[8px] px-3 py-2 text-gray-700"
              formControlName="nueva"
            />
            <span>La contraseña debe tener al menos: <br /></span>
            <span class="input-helper"
              >- Ocho caracteres.<br />- Una letra mayúscula. <br />- Una letra minúscula. <br />-
              Un número.<br />- Un carácter especial (!%$&_@).</span
            >
            @if (perfilForm.get("nueva")?.touched) {
            <p class="input-error-text">
              @if(perfilForm.get("nueva")?.errors?.['required']){ Campo requerido. }
              @if(perfilForm.get("nueva")?.errors?.['pattern']){ La contraseña nueva no cumple con
              los requisitos. }
            </p>
            }
          </div>

          <div class="input-group py-2">
            <label class="input-helper"> Confirma tu contraseña nueva</label>
            <input
              type="password"
              class="bg-stone-100 border border-stone-300 rounded-[8px] px-3 py-2 text-gray-700"
              formControlName="confirmar"
            />
            @if (perfilForm.get("confirmar")?.touched) {
            <p class="input-error-text">
              @if(perfilForm.get("confirmar")?.errors?.['required']){ Campo requerido. }
              @if(perfilForm.get("confirmar")?.value !== perfilForm.get("nueva")?.value){ Las
              contraseñas no coinciden. }
            </p>
            }
          </div>

          } @else if(modoEditar()){

          <div class="input-group py-2">
            <label class="input-helper"> Ingresa el nombre nuevo</label>
            <input
              type="text"
              class="bg-stone-100 border border-stone-300 rounded-[8px] px-3 py-2 text-gray-700"
              formControlName="nombre"
            /><span class="input-error-text">
              @if (perfilForm.get("nombre")?.invalid && perfilForm.get("nombre")?.touched) { @if
              (perfilForm.get("nombre")?.errors?.["required"]) {Campo requerido.} @if
              (perfilForm.get("nombre")?.errors?.["minlength"]) {El nombre debe tener al menos 3
              letras.} }
            </span>
          </div>

          <div class="input-group py-2">
            <label class="input-helper">Ingresa el apellido nuevo </label>
            <input
              type="text"
              class="bg-stone-100 border border-stone-300 rounded-[8px] px-3 py-2 text-gray-700"
              formControlName="apellido"
            /><span class="input-error-text">
              @if (perfilForm.get("apellido")?.invalid && perfilForm.get("apellido")?.touched) { @if
              (perfilForm.get("apellido")?.errors?.["required"]) {Campo requerido.} @if
              (perfilForm.get("apellido")?.errors?.["minlength"]) {El apellido debe tener al menos 3
              letras.} }
            </span>
          </div>

          <div class="input-group py-2">
            <label class="input-helper">Gmail:</label>
            <input
              type="text"
              class="bg-stone-100 border border-stone-300 rounded-[8px] px-3 py-2 text-gray-700"
              formControlName="email"
            />
            <span class="text-primary">El mail no puede ser editado.</span>
          </div>
          } @else{

          <div class="input-group py-2">
            <label class="input-helper">Nombre</label>
            <input
              type="text"
              class="bg-stone-100 border border-stone-300 rounded-[8px] px-3 py-2 text-gray-700"
              formControlName="nombre"
            />
          </div>

          <div class="input-group py-2">
            <label class="input-helper">Apellido</label>
            <input
              type="text"
              class="bg-stone-100 border border-stone-300 rounded-[8px] px-3 py-2 text-gray-700"
              formControlName="apellido"
            />
          </div>
          <div class="input-group py-2">
            <label class="input-helper">Gmail:</label>
            <input
              type="text"
              class="bg-stone-100 border border-stone-300 rounded-[8px] px-3 py-2 text-gray-700"
              formControlName="email"
            />
          </div>
          }

          <div class="flex flex-col gap-4 py-4">
            <div class="flex flex-row gap-4">
              @if (!modoEditar() && !modoContrasenia()) {
              <button
                type="button"
                class="btn btn-outline btn-sm flex-1"
                (click)="activarModoEditar()"
              >
                Editar Perfil
              </button>
              <button
                type="button"
                class="btn btn-outline btn-sm flex-1"
                (click)="activarEditarContrasenia()"
              >
                Cambiar Contraseña
              </button>
              }@else{
              <button
                type="button"
                class="btn btn-success btn-md flex-1"
                (click)="guardarCambios()"
              >
                Aceptar cambios
              </button>
              <button
                type="button"
                class="btn btn-danger btn-md flex-1"
                (click)="cancelarEdicion()"
              >
                Cancelar cambios
              </button>
              }
            </div>

            <button type="button" class="btn btn-danger btn-sm mt-5" (click)="authService.logout()">
              Cerrar sesión
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="flex-2 flex flex-col mt-6">
    <div class="flex justify-between py-3">
      <h2 class="text-2xl font-semibold">Mis publicaciones</h2>

      <!-- si el usuario no administrador, se muestra el boton para crear un publicacion -->
      @if (!authService.isAdmin()) {
      <a class="btn btn-sm btn-primary" routerLink="/publicaciones/crear">+ Crear Publicación </a>
      }
    </div>
    <p>Componente de las cards llamadas por el ID del miembro</p>
  </div>
</article>
