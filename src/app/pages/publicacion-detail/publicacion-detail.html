<div class="max-w-3xl mx-auto mb-4">
  <a class="btn btn-sm bg-primary-foreground border-2" routerLink="/publicaciones">← Atrás</a>
</div>

<div class="card max-w-3xl mx-auto relative w-full shadow-md">
  <!-- tag con estado de la mascota -->
  <span
    class="tag"
    [ngClass]="{
      'tag-perdido': publicacion()?.estadoMascota === 'perdido',
      'tag-encontrado': publicacion()?.estadoMascota === 'encontrado',
      'tag-reencontrado': publicacion()?.estadoMascota === 'reencontrado'
    }"
    >{{ publicacion()?.estadoMascota }}</span
  >
  <!-- Imagen -->
  <div class="grid grid-cols-2">
    <div class="h-90 w-full">
      <img
        class="size-full object-cover"
        [src]="publicacion()?.urlFoto"
        [alt]="publicacion()?.nombreMascota"
      />
    </div>

    <!-- Contenedor para la informacion -->
    <div class="relative flex flex-col px-6">
      <!-- Div para nombre, fecha, ubicacion -->
      <div class="flex flex-col">
        <!-- titulo, nombre de la mascota -->
        @if (publicacion()?.nombreMascota?.length === 0) {
        <h2 class="text-gray-400 card-title text-3xl py-3 text-left!">Sin nombre</h2>
        }
        <h2 class="card-title text-3xl py-3 text-left!">{{ publicacion()?.nombreMascota }}</h2>

        <p class="pb-6">
          Publicado por: <strong class="capitalize">{{ nombreCreador() }}</strong>
        </p>

        <!-- Div UBICACION -->
        <div class="flex gap-1 items-center justify-start">
          <!-- svg ubicacion -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#ff971c"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-map-pin-icon lucide-map-pin"
          >
            <path
              d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"
            />
            <circle cx="12" cy="10" r="3" />
          </svg>
          <p class="text-s capitalize">{{ publicacion()?.calle }}, {{ publicacion()?.altura }}</p>
        </div>

        <!-- Div FECHA -->
        <div class="flex gap-1 items-center justify-start">
          <!-- svg calendario -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#ff971c"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-calendar1-icon lucide-calendar-1"
          >
            <path d="M11 14h1v4" />
            <path d="M16 2v4" />
            <path d="M3 10h18" />
            <path d="M8 2v4" />
            <rect x="3" y="4" width="18" height="18" rx="2" />
          </svg>
          <p class="text-s capitalize">{{ publicacion()?.fecha | date : 'EEEE d, MMMM' }}</p>
        </div>
      </div>

      <!-- Los botones se muestran segun el rol del usuario, y si la publicacion le pertenece o no -->

      <!-- solo se muestra al admin-->
      @if(puedeEliminar() && isAdmin()){
      <p class="text-sm text-center pt-8 text-destructive">
        Como Administrador, podés eliminar esta publicación si inflige con las Normas de la
        Comunidad.
      </p>
      }

      <hr class="mt-6 border-1" />

      <div class="flex flex-col mb-8 items-center justify-center flex-1">
        <!-- Boton para cambiar a estado reencontrado, solo se muestra si la pub pertenece a la persona loggeada, y el estado es perdido o encontrado -->
        @if(authService.estaLogeado() && puedeEditar() && publicacion()?.estadoMascota !==
        'reencontrado'){
        <p class="text-sm mb-2 text-center font-semibold leading-[1.3]">
          ¿Tu mascota fue reencontrada? <br />
          Avisale a la comunidad!
        </p>
        <button class="btn btn-sm btn-success w-fit" (click)="cambiarEstadoAReencontrado()">
          Marcar como reencontrado
        </button>
        }

        <!-- solo a los usuarios no propietarios de la publicacion -->
        @if(!puedeEliminar() && !puedeEditar()){
        <p class="text-sm mb-2 text-center font-semibold leading-[1.3]">
          Si sabes algo ayuda comentando!
        </p>
        <div class="flex justify-center items-center gap-1.5">
          <button class="btn btn-md btn-outline" (click)="irAComentarios()">Comentar</button>
        </div>
        }
      </div>

      <!-- Div BOTONES -->
      <div class="absolute right-4 top-4 flex justify-center items-center gap-1.5">
        <!-- primero se evalua que el usuario este logeado -->
        @if(authService.estaLogeado()){
        <!-- solo se muestra el propietario de la publicacion -->
        @if (puedeEditar()) {
        <button class="btn btn-primary btn-sm px-1.5!" (click)="navigateToUpdate()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-square-pen-icon lucide-square-pen"
          >
            <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path
              d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"
            />
          </svg>
        </button>
        }

        <!-- solo se muestra el propietario de la publicacion y al admin -->
        @if (puedeEliminar()) {
        <button class="btn btn-danger btn-sm px-1.5!" (click)="deletePublicacion()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M3 6h18" />
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
            <line x1="10" x2="10" y1="11" y2="17" />
            <line x1="14" x2="14" y1="11" y2="17" />
          </svg>
        </button>
        } }
      </div>
    </div>
  </div>
  <div class="card-body bg-primary/10 border-t-3">
    <p class="text-center text-pretty">
      {{ publicacion()?.descripcion }}
    </p>
  </div>
</div>

<!-- renderizacion de los comentarios de la publicacion -->
@if (publicacion(); as pub) {
<app-comentario-list [publicacionId]="pub.id" />
}
